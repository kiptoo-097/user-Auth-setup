<nav class="bg-white shadow px-4 py-3" x-data="{ open: false }">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
        <!-- Logo -->
        <a href="/" class="text-xl font-bold text-blue-600">AuthSystem</a>

        <!-- Mobile Menu Button -->
        <div class="lg:hidden">
            <button @click="open = !open" class="text-gray-700 focus:outline-none">
                <svg x-show="!open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
                <svg x-show="open" x-cloak class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden lg:flex space-x-4 items-center">
            {% for link in navlinks %}
                {% if link.is_dropdown %}
                    <div class="relative group">
                        <button class="text-gray-700 hover:text-blue-600 font-medium focus:outline-none">
                            {{ link.name }}
                        </button>
                        <div class="absolute left-0 mt-2 bg-white border shadow-lg rounded z-50 min-w-[10rem] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150">
                            {% for sub in link.dropdowns.all %}
                                {% with sub.url as sub_url %}
                                    {% url sub_url as resolved_sub_url %}
                                    <a href="{{ resolved_sub_url|default:sub_url }}" class="block px-4 py-2 hover:bg-gray-100 text-sm text-gray-700">
                                        {{ sub.name }}
                                    </a>
                                {% endwith %}
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    {% with link.url as url_name %}
                        {% url url_name as resolved_url %}
                        <a href="{{ resolved_url|default:url_name }}" class="text-gray-700 hover:text-blue-600">{{ link.name }}</a>
                    {% endwith %}
                {% endif %}
            {% endfor %}
        </div>

        <!-- Auth Links (desktop) -->
        <div class="hidden lg:flex space-x-4">
            {% if user.is_authenticated %}
                <a href="{% url 'profile' %}" class="text-gray-700 hover:text-blue-600">Profile</a>
                <form method="post" action="{% url 'logout' %}" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="text-red-600 hover:underline">Logout</button>
                </form>
            {% else %}
                <a href="{% url 'login' %}" class="text-gray-700 hover:text-blue-600">Login</a>
                <a href="{% url 'register' %}" class="text-gray-700 hover:text-blue-600">Register</a>
            {% endif %}
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="lg:hidden mt-4 space-y-2 px-2" x-show="open" x-cloak>
        {% for link in navlinks %}
            {% if link.is_dropdown %}
                <div>
                    <span class="block font-semibold text-gray-700">{{ link.name }}</span>
                    {% for sub in link.dropdowns.all %}
                        {% with sub.url as sub_url %}
                            {% url sub_url as resolved_sub_url %}
                            <a href="{{ resolved_sub_url|default:sub_url }}" class="block pl-4 py-1 text-sm text-gray-600 hover:text-blue-600">{{ sub.name }}</a>
                        {% endwith %}
                    {% endfor %}
                </div>
            {% else %}
                {% with link.url as url_name %}
                    {% url url_name as resolved_url %}
                    <a href="{{ resolved_url|default:url_name }}" class="block text-gray-700 hover:text-blue-600">{{ link.name }}</a>
                {% endwith %}
            {% endif %}
        {% endfor %}

        {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="block text-gray-700 hover:text-blue-600">Profile</a>
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="block text-red-600 hover:underline">Logout</button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" class="block text-gray-700 hover:text-blue-600">Login</a>
            <a href="{% url 'register' %}" class="block text-gray-700 hover:text-blue-600">Register</a>
        {% endif %}
    </div>
</nav>
